package com.hck.getmoney.ui;import java.util.ArrayList;import java.util.List;import org.json.JSONException;import org.json.JSONObject;import android.os.Bundle;import android.util.Log;import android.view.View;import android.widget.AdapterView;import android.widget.AdapterView.OnItemClickListener;import android.widget.Button;import android.widget.ListView;import android.widget.TextView;import com.hck.kedouzq.R;import com.hck.getmoney.adpter.MessageAdpter;import com.hck.getmoney.bean.MessageBean;import com.hck.getmoney.data.Data;import com.hck.getmoney.data.HttpUrls;import com.hck.getmoney.net.JsonHttpResponseHandler;import com.hck.getmoney.net.RequestParams;import com.hck.getmoney.util.HttpUtil;import com.hck.getmoney.util.JsonUtil;import com.hck.getmoney.widget.AlertDialogs;import com.hck.getmoney.widget.PDialog;import com.hck.getmoney.widget.Toasts;public class MessageActivity extends BaseActivity implements BaseMethod,		BaseAlert {	private ListView listView;	private MessageAdpter adpter;	private TextView textView;	private List<MessageBean> messageBeans;	 private Button button;	@Override	protected void onCreate(Bundle savedInstanceState) {		super.onCreate(savedInstanceState);		setContentView(R.layout.activity_message);		initViews();		initDatas();		setListener();		getData();	}	public void back(View view)	  {		  this.finish();	  }	@Override	public void initDatas() {		messageBeans = new ArrayList<MessageBean>();	}	@Override	public void initViews() {		listView = (ListView) findViewById(R.id.list_message);		textView = (TextView) findViewById(R.id.title_text);		textView.setText("我的短消息");		button=(Button) findViewById(R.id.title_bt_left);	}	@Override	public void setListener() {		listView.setOnItemClickListener(new OnItemClickListener() {			@Override			public void onItemClick(AdapterView<?> arg0, View arg1, int arg2,					long arg3) {				AlertDialogs.alertDialog(MessageActivity.this,						MessageActivity.this, "确定删除吗?", "取消", "删除",						"message_no", arg2+"");			}		});	}	@Override	public void getData() {		PDialog.showDialog(this, "数据加载中", "请稍等");		params = new RequestParams();		params.put("id", Data.userBean.getId() + "");		HttpUtil.getHttpUtil().get(HttpUrls.getUserMessageP, params,				new JsonHttpResponseHandler() {					@Override					public void onFailure(Throwable error, String content) {						super.onFailure(error, content);						Toasts.toast(MessageActivity.this, "获取数据失败");					}					@Override					public void onSuccess(int statusCode, JSONObject response) {						super.onSuccess(statusCode, response);						try {							isOk = response.getBoolean("isok");							if (isOk) {								JsonUtil.getJsonUtil().getMessage(response,										messageBeans);								setDate();							} else {								Toasts.toast(MessageActivity.this, "没有获取到信息");							}						} catch (JSONException e) {							e.printStackTrace();						}					}					@Override					public void onFinish(String url) {						super.onFinish(url);						PDialog.hidenDialog();					}				});	}	@Override	public void setDate() {		Log.i("hck", messageBeans.size() + "   ss");		adpter = new MessageAdpter(this, messageBeans);		listView.setAdapter(adpter);	}	@Override	public void doLeftButton(String value) {	}	@Override	public void doRightButton(String value) {		Toasts.toast(this, "删除成功");		try {			int postion = Integer.parseInt(value);			deleteMessage(messageBeans.get(postion).getId(),postion);		} catch (Exception e) {		}	}	private void deleteMessage(final int mid,final int p) {				PDialog.showDialog(this, "正在删除", "请稍等");		params = null;		params = new RequestParams();		params.put("mid", mid + "");		HttpUtil.getHttpUtil().get(HttpUrls.deleteMessageP, params,				new JsonHttpResponseHandler() {					@Override					public void onFailure(Throwable e, JSONObject errorResponse) {						super.onFailure(e, errorResponse);						Toasts.toast(MessageActivity.this, "删除失败");					}					@Override					public void onFinish(String url) {						super.onFinish(url);						PDialog.hidenDialog();					}					@Override					public void onSuccess(int statusCode, JSONObject response) {						super.onSuccess(statusCode, response);						try {							isOk=response.getBoolean("isok");							if (isOk) {							  messageBeans.remove(p);								  adpter.notifyDataSetChanged();							}							else {								Toasts.toast(MessageActivity.this, "删除失败");							}						} catch (JSONException e) {							e.printStackTrace();						}											}				});	}	@Override	public void doSometing(String value) {		// TODO Auto-generated method stub			}}