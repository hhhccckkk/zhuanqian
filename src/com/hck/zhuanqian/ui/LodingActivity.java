package com.hck.zhuanqian.ui;import java.net.InetAddress;import java.net.NetworkInterface;import java.net.SocketException;import java.util.Enumeration;import org.json.JSONException;import org.json.JSONObject;import android.app.Activity;import android.content.Context;import android.net.wifi.WifiInfo;import android.net.wifi.WifiManager;import android.os.Bundle;import android.os.Handler;import android.text.TextUtils;import android.util.Log;import android.view.View;import android.view.WindowManager;import android.widget.FrameLayout;import android.widget.ImageView;import android.widget.LinearLayout;import android.widget.TextView;import com.hck.zhuanqian.R;import com.hck.zhuanqian.data.Data;import com.hck.zhuanqian.data.HttpUrls;import com.hck.zhuanqian.net.JsonHttpResponseHandler;import com.hck.zhuanqian.net.RequestParams;import com.hck.zhuanqian.util.HttpUtil;import com.hck.zhuanqian.util.JsonUtil;import com.hck.zhuanqian.util.MyPreferences;import com.hck.zhuanqian.util.MyTools;import com.hck.zhuanqian.util.UIHelp;import com.hck.zhuanqian.widget.AlertDialogs;import com.hck.zhuanqian.widget.Toasts;import com.hck.zhuanqian.widget.AlertDialogs.OneBtOnclick;import com.qq.e.splash.SplashAd;import com.qq.e.splash.SplashAdListener;public class LodingActivity extends Activity {	private ImageView imageView;	private TextView textView;	private View view;	boolean isOk = false;	@Override	protected void onCreate(Bundle savedInstanceState) {		super.onCreate(savedInstanceState);		getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,				WindowManager.LayoutParams.FLAG_FULLSCREEN);		setContentView(R.layout.activity_loding);		addUser();		getConfig();		initDate();		view = findViewById(R.id.pb);		imageView = (ImageView) findViewById(R.id.loding);		textView = (TextView) findViewById(R.id.text_error);	}	Handler handler = new Handler() {		public void handleMessage(android.os.Message msg) {			startMainActivity();		};	};	private void startMainActivity() {		view.setVisibility(View.GONE);		UIHelp.startMainActivity(LodingActivity.this);	}	private void initDate() {		new MyPreferences(this);		new MyTools(this);	}	private void alertErrorD() {		try {			AlertDialogs.alert(LodingActivity.this, "", "您的网络不佳,无法进去，请重试",					false, new OneBtOnclick() {						@Override						public void callBack(int tag) {							finish();						}					}, 1);		} catch (Exception e) {		}	}	private void addUser() {		if (TextUtils.isEmpty(MyTools.getImei(this))) {			Toasts.toast(this, "请允许手机获取IMEI作为你的唯一标识");			finish();			return;		} else if (MyTools.getImei(this).equals("000000000000000")) {			Toasts.toast(this, "模拟器，不能使用本软件");			this.finish();			return;		}		RequestParams params = new RequestParams();		params.put("mac", MyTools.getImei(this));		params.put("phone", MyTools.getTel(this));		params.put("point", 0 + "");		params.put("xh", MyTools.getModel());		params.put("sdk", MyTools.getSDK());		params.put("ips", getLocalIpAddress());		HttpUtil.getHttpUtil().get(HttpUrls.addUser, params,				new JsonHttpResponseHandler() {					public void onFailure(Throwable error, String content) {						alertErrorD();					};					public void onFinish(String url) {					};					public void onSuccess(int statusCode,							org.json.JSONObject response) {						try {							boolean isOk = response.getBoolean("isok");							if (isOk) {								JsonUtil.getJsonUtil().getUserData(response);								if (Data.userBean.getIsok() == 0) {									imageView.setVisibility(View.GONE);									textView.setVisibility(View.VISIBLE);									view.setVisibility(View.GONE);									return;								}								handler.sendEmptyMessage(1);							} else {								Toasts.toast(LodingActivity.this,										"注册用户失败 请检查网络");							}						} catch (JSONException e) {							e.printStackTrace();							Toasts.toast(LodingActivity.this, "未知错误");						}					};				});	}	public String getLocalIpAddress() {		String mac = getLocalMacAddress();		try {			for (Enumeration<NetworkInterface> en = NetworkInterface					.getNetworkInterfaces(); en.hasMoreElements();) {				NetworkInterface intf = en.nextElement();				for (Enumeration<InetAddress> enumIpAddr = intf						.getInetAddresses(); enumIpAddr.hasMoreElements();) {					InetAddress inetAddress = enumIpAddr.nextElement();					if (!inetAddress.isLoopbackAddress()) {						return inetAddress.getHostAddress().toString() + " "								+ mac;					}				}			}		} catch (SocketException ex) {			Log.e("ifo", ex.toString());		}		return "";	}	public String getLocalMacAddress() {		WifiManager wifi = (WifiManager) getSystemService(Context.WIFI_SERVICE);		WifiInfo info = wifi.getConnectionInfo();		return info.getMacAddress();	}	private void getConfig() {		RequestParams params = new RequestParams();		params.put("configId", 1 + "");		HttpUtil.getHttpUtil().get(HttpUrls.getConfigP, params,				new JsonHttpResponseHandler() {					@Override					public void onFailure(Throwable error, String content) {						super.onFailure(error, content);						alertErrorD();					}					@Override					public void onFinish(String url) {						super.onFinish(url);					}					@Override					public void onSuccess(int statusCode, JSONObject response) {						super.onSuccess(statusCode, response);						try {							isOk = response.getBoolean("isok");							if (isOk) {								JsonUtil.getJsonUtil().getNews(response);							}						} catch (Exception e) {						}					}				});	}}