package com.hck.getmoney.ui;import org.json.JSONObject;import android.os.Bundle;import android.os.Handler;import android.os.Message;import android.util.Log;import android.view.View;import android.widget.TextView;import com.hck.getmoney.data.Data;import com.hck.getmoney.data.HttpUrls;import com.hck.getmoney.net.JsonHttpResponseHandler;import com.hck.getmoney.net.RequestParams;import com.hck.getmoney.util.HttpUtil;import com.hck.getmoney.widget.Toasts;import com.jy.func.JYOfferWall;import com.jy.func.lner.CheckPointListener;import com.jy.func.lner.ErrorInfo;import com.jy.func.lner.Point;import com.hck.kedouzq.R;/** *  * @author *  */public class JiongYouActivity extends BaseActivity {	private int num;	private String content;	private int point;	private TextView nameTextView, contenTextView;	private int kid;	@Override	protected void onCreate(Bundle savedInstanceState) {		super.onCreate(savedInstanceState);		initJiongYou();		setContentView(R.layout.activity_play_dl);		initView();		kid = getIntent().getIntExtra("kid", 0);		num = getIntent().getIntExtra("num", 5);		content = getIntent().getStringExtra("neirong");		initDate();		nt();	}	private void initView() {		nameTextView = (TextView) findViewById(R.id.play_dl_name);		contenTextView = (TextView) findViewById(R.id.play_dl_content);	}	private void initDate() {		nameTextView.setText("本区每天限制下载试用" + num + "个软件");		contenTextView.setText(content);	}	private void initJiongYou() {		try {			JYOfferWall.getInstance(this).init(this, "56918", "1008",					"1da95f66041816e9f3ed32fd4802b3e9");				} catch (Exception e) {			Toasts.toast(JiongYouActivity.this,					"初始化数据失败 请重试 ");			finish();		}	}			public void startGetMoney(View view) {		try {			showJiongYou();		} catch (Exception e) {			Toasts.toast(JiongYouActivity.this,					"初始化数据失败 请重试 ");		}			}	private void showJiongYou() { //		JYOfferWall.getInstance(this).showOfferWall(this);	}	Handler handler = new Handler() {		public void handleMessage(android.os.Message msg) {			point=0;			point = msg.what;			money= point;			if (point>600) {				point=100;			}			if (point > 0) {				savePoint();			}			huafei(point);		};	};	private void savePoint() {		point= hashYQM(point);		params = new RequestParams();		params.put("kindid", kid + "");		params.put("num", num + "");		params.put("type", "炅友");		if (Data.userBean == null) {			Toasts.toast(this, "增加金币异常  请重新登录");			return;		}		params.put("uid", Data.userBean.getId() + "");		params.put("money", point + "");		HttpUtil.getHttpUtil().get(HttpUrls.addMoneyP, params,				new JsonHttpResponseHandler() {					@Override					public void onFinish(String url) {						super.onFinish(url);						huafei(money);											}					@Override					public void onFailure(Throwable error, String content) {						super.onFailure(error, content);						Toasts.toast(getApplicationContext(), "网络异常 增加金币失败 ");					}					@Override					public void onSuccess(int statusCode, JSONObject response) {						super.onSuccess(statusCode, response);												try {							isOk = response.getBoolean("isok");							if (isOk) {								Toasts.toast(getApplicationContext(),nt);								Data.userBean.setAllKeDouBi(Data.userBean										.getAllKeDouBi() + point);							} else {								if (response.getInt("type") == 1) {									Toasts.toast(getApplicationContext(),											"获取金币失败 本区每天限制下载" + num + "个应用  ");								} else {									Toasts.toast(getApplicationContext(),											"网络异常 增加金币失败 ");								}							}						} catch (Exception e) {							Toasts.toast(JiongYouActivity.this, "网络异常 增加金币失败 ");						}					}				});	}	@Override	protected void onResume() {		super.onResume();		JYOfferWall.getInstance(this).checkPoints(new CheckPointListener() {			@Override			public void onError(ErrorInfo arg0) {			}			@Override			public void onResponse(Point arg0) {				int jinbi = 0;				point=0;				if (arg0 != null) {					jinbi = (int) arg0.point;					point=jinbi;				}				if (jinbi > 0) {						Message message = new Message();						message.what = jinbi;						handler.sendMessage(message);				}			}		});	}	private void huafei(int point) {		Log.d("hck", "huafei : " + point);		JYOfferWall.getInstance(this).consumePoints(point,				new CheckPointListener() {					@Override					public void onError(ErrorInfo arg0) {						Log.d("hck", "huafei onError: " + arg0);					}					@Override					public void onResponse(Point arg0) {					}				});	}}