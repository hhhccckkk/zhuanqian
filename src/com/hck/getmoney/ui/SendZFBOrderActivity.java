package com.hck.getmoney.ui;import org.json.JSONException;import org.json.JSONObject;import android.os.Bundle;import android.text.TextUtils;import android.view.View;import android.widget.EditText;import android.widget.TextView;import com.hck.kedouzq.R;import com.hck.getmoney.data.Data;import com.hck.getmoney.data.HttpUrls;import com.hck.getmoney.net.JsonHttpResponseHandler;import com.hck.getmoney.net.RequestParams;import com.hck.getmoney.util.HttpUtil;import com.hck.getmoney.util.MyPreferences;import com.hck.getmoney.util.MyTools;import com.hck.getmoney.widget.AlertDialogs;import com.hck.getmoney.widget.PDialog;import com.hck.getmoney.widget.Toasts;public class SendZFBOrderActivity extends BaseActivity implements BaseMethod ,BaseAlert{	private int type;	private TextView titleTextView;	private EditText num1tEditText, num2tEditText,namEditText;	private int num1;	private String qqString;	private int canGetMoney;	private String qqString2;	private String name;	@Override	protected void onCreate(Bundle savedInstanceState) {		super.onCreate(savedInstanceState);		setContentView(R.layout.activity_zfb);		initDatas();		initViews();		setListener();		getData();	}	public void sendOrder(View view) {		String num3 = num1tEditText.getText().toString();		qqString = num2tEditText.getText().toString();		name=namEditText.getText().toString();		if (MyTools.isNull(num3)) {			Toasts.toast(this, "兑换人民币数量不能为空");			return;		}		if (MyTools.isNull(qqString)) {			Toasts.toast(this, "支付宝账号不能为空");			return;		}		try {			num1 = Integer.parseInt(num3);		} catch (Exception e) {			Toasts.toast(this, "请输入整数");			return;		}		if (num1 < 5) {			Toasts.toast(this, "兑换数量必须是大于等于5的整数");			return;		}		if (num1 > canGetMoney) {			Toasts.toast(this, "兑换数量不能超过最大兑换值");			return;		}		if (namEditText.getText()==null) {			Toasts.toast(this, "请输入支付宝账号的真实姓名");			return;		}		MyPreferences.saveString("zfb", qqString);		MyPreferences.saveString("name", namEditText.getText().toString());		sendData();	}	private void sendData() {		PDialog.showDialog(this, "请稍等哦...", "正在处理中");		params = new RequestParams();		params.put("id", Data.userBean.getId() + "");		params.put("money", num1 * 1000 + "");		params.put("yqm", Data.userBean.getShangjia());		params.put("content", "支付宝账号：" + qqString +  name+ " h兑换了" + num1 + "元人民币");				params.put("userName", Data.userBean.getName());				int money=(int) (num1*1000*Data.bili);		params.put("tjmoney", money+"");		HttpUtil.getHttpUtil().get(HttpUrls.addOrderP, params,				new JsonHttpResponseHandler() {					@Override					public void onFinish(String url) {						super.onFinish(url);						PDialog.hidenDialog();					}					@Override					public void onFailure(Throwable error, String content) {						super.onFailure(error, content);						Toasts.toast(SendZFBOrderActivity.this, "下单失败 请检查网络");						SendZFBOrderActivity.this.finish();					}					@Override					public void onSuccess(int statusCode, JSONObject response) {						super.onSuccess(statusCode, response);						try {							isOk = response.getBoolean("isok");						} catch (JSONException e) {							e.printStackTrace();						}						if (isOk) {							Data.userBean.setAllKeDouBi(Data.userBean									.getAllKeDouBi() - num1 * 1000);							new AlertDialogs().alert(SendZFBOrderActivity.this, SendZFBOrderActivity.this, "兑换成功", "下单成功了" +									" 最迟1-5个工作日内到账,您可以在用户中心查看未处理订单和已经完成的订单");						} else {							Toasts.toast(SendZFBOrderActivity.this, "下单失败 请检查网络");							SendZFBOrderActivity.this.finish();						}					}				});	}	@Override	public void initDatas() {		qqString2 = MyPreferences.getString("zfb", null);		name=MyPreferences.getString("name", null);		type = getIntent().getIntExtra("type", 0);		canGetMoney = (int) (Data.userBean.getAllKeDouBi() / 1000);	}	@Override	public void initViews() {		titleTextView = (TextView) findViewById(R.id.send_order_title);		num1tEditText = (EditText) findViewById(R.id.num1);		num2tEditText = (EditText) findViewById(R.id.num2);		namEditText=(EditText)findViewById(R.id.num3);		titleTextView.setText("您当前有金币: " + Data.userBean.getAllKeDouBi()				+ " 个. 最多可以兑换 " + canGetMoney + " 元人民币");		if (qqString2 != null) {			num2tEditText.setText(qqString2);		}		if (name!=null) {			namEditText.setText(name);		}		if (!TextUtils.isEmpty(Data.userBean.getZhifubao())) {			num2tEditText.setText(Data.userBean.getZhifubao());		}	}	@Override	public void setListener() {	}	@Override	public void getData() {	}	@Override	public void setDate() {	}	@Override	public void doLeftButton(String value) {		// TODO Auto-generated method stub			}	@Override	public void doRightButton(String value) {		// TODO Auto-generated method stub			}	@Override	public void doSometing(String value) {		this.finish();		overridePendingTransition(R.anim.iphone1, R.anim.iphone2);					}}