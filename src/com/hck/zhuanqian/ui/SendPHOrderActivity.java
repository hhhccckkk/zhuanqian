package com.hck.zhuanqian.ui;import org.json.JSONException;import org.json.JSONObject;import android.os.Bundle;import android.text.TextUtils;import android.view.View;import android.widget.EditText;import android.widget.TextView;import com.hck.zhuanqian.R;import com.hck.zhuanqian.data.Data;import com.hck.zhuanqian.data.HttpUrls;import com.hck.zhuanqian.net.JsonHttpResponseHandler;import com.hck.zhuanqian.net.RequestParams;import com.hck.zhuanqian.util.HttpUtil;import com.hck.zhuanqian.util.MyPreferences;import com.hck.zhuanqian.util.MyTools;import com.hck.zhuanqian.widget.AlertDialogs;import com.hck.zhuanqian.widget.PDialog;import com.hck.zhuanqian.widget.Toasts;public class SendPHOrderActivity extends BaseActivity implements BaseMethod,BaseAlert {	private int type;	private TextView titleTextView;	private EditText num1tEditText, num2tEditText;	private int num1;	private String qqString;	private int canGetMoney;	private String qqString2;	@Override	protected void onCreate(Bundle savedInstanceState) {		super.onCreate(savedInstanceState);		setContentView(R.layout.activity_sendorderph);		initDatas();		initViews();		setListener();		getData();	}	public void sendOrder(View view) {		String num3 = num1tEditText.getText().toString();		qqString = num2tEditText.getText().toString();		if (MyTools.isNull(num3)) {			Toasts.toast(this, "兑换人民币数量不能为空");			return;		}		if (MyTools.isNull(qqString)) {			Toasts.toast(this, "电话号码不能为空");			return;		}		try {			num1 = Integer.parseInt(num3);		} catch (Exception e) {			Toasts.toast(this, "请输入整数");			return;		}		if (num1!=20 && num1!=30  &&num1!=50) {			Toasts.toast(this, "兑换数量必须是20，30，或者50");			return;		}		if (num1 > canGetMoney) {			Toasts.toast(this, "兑换数量不能超过最大兑换值");			return;		}				MyPreferences.saveString("phone", qqString);				sendData();	}	private void sendData() {		PDialog.showDialog(this, "请稍等哦...", "正在处理中");		params = new RequestParams();		params.put("id", Data.userBean.getId() + "");		params.put("money", num1 * 1000 + "");		params.put("yqm", Data.userBean.getShangjia());		params.put("content", "电话号码：" + qqString + "h兑换了" + num1 + "话费");				params.put("userName", Data.userBean.getName());				int money=(int) (num1*1000*Data.bili);		params.put("tjmoney", money+"");		HttpUtil.getHttpUtil().get(HttpUrls.addOrderP, params,				new JsonHttpResponseHandler() {					@Override					public void onFinish(String url) {						super.onFinish(url);						PDialog.hidenDialog();					}					@Override					public void onFailure(Throwable error, String content) {						super.onFailure(error, content);						Toasts.toast(SendPHOrderActivity.this, "下单失败 请检查网络");						SendPHOrderActivity.this.finish();					}					@Override					public void onSuccess(int statusCode, JSONObject response) {						super.onSuccess(statusCode, response);						try {							isOk = response.getBoolean("isok");						} catch (JSONException e) {							e.printStackTrace();						}						if (isOk) {							Data.userBean.setAllKeDouBi(Data.userBean									.getAllKeDouBi() - num1 * 1000);							new AlertDialogs().alert(SendPHOrderActivity.this, SendPHOrderActivity.this, "兑换成功", "下单成功了" +									" 最迟1-5个工作日内到账,您可以在用户中心查看未处理订单和已经完成的订单");													} else {							Toasts.toast(SendPHOrderActivity.this, "下单失败 请检查网络");							SendPHOrderActivity.this.finish();						}					}				});	}	@Override	public void initDatas() {		qqString2 = MyPreferences.getString("phone", null);		type = getIntent().getIntExtra("type", 0);		canGetMoney = (int) (Data.userBean.getAllKeDouBi() / 1000);	}	@Override	public void initViews() {		titleTextView = (TextView) findViewById(R.id.send_order_title);		num1tEditText = (EditText) findViewById(R.id.num1);		num2tEditText = (EditText) findViewById(R.id.num2);		titleTextView.setText("您当前有金币: " + Data.userBean.getAllKeDouBi()				+ " 个. 最多可以兑换 " + canGetMoney + " 话费");		if (qqString2 != null) {			num2tEditText.setText(qqString2);		}		if (!TextUtils.isEmpty(Data.userBean.getPhone())) {			num2tEditText.setText(Data.userBean.getPhone());		}			}	@Override	public void setListener() {	}	@Override	public void getData() {	}	@Override	public void setDate() {	}	@Override	public void doLeftButton(String value) {		// TODO Auto-generated method stub			}	@Override	public void doRightButton(String value) {		// TODO Auto-generated method stub			}	@Override	public void doSometing(String value) {		this.finish();		overridePendingTransition(R.anim.iphone1, R.anim.iphone2);			}}