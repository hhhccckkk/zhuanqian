package com.hck.zhuanqian.ui;import java.util.ArrayList;import java.util.List;import org.json.JSONArray;import org.json.JSONException;import org.json.JSONObject;import android.os.Bundle;import android.util.Log;import android.view.View;import android.widget.AdapterView;import android.widget.AdapterView.OnItemClickListener;import android.widget.Button;import android.widget.ListView;import android.widget.TextView;import com.hck.zhuanqian.R;import com.hck.zhuanqian.adpter.NoChuLiOrderAdpter;import com.hck.zhuanqian.bean.OrderBean;import com.hck.zhuanqian.data.Data;import com.hck.zhuanqian.data.HttpUrls;import com.hck.zhuanqian.net.JsonHttpResponseHandler;import com.hck.zhuanqian.net.RequestParams;import com.hck.zhuanqian.util.HttpUtil;import com.hck.zhuanqian.util.JsonUtil;import com.hck.zhuanqian.widget.PDialog;import com.hck.zhuanqian.widget.Toasts;public class MyOrderActivity extends BaseActivity implements BaseMethod {	private int tag;	private TextView titleTextView;	private List<OrderBean> beans;	private NoChuLiOrderAdpter adpter;	private ListView listView;	private Button button;	@Override	protected void onCreate(Bundle savedInstanceState) {		super.onCreate(savedInstanceState);		setContentView(R.layout.activity_my_order);		initDatas();		initViews();		getData();		setListener();	}	@Override	public void initDatas() {		tag = getIntent().getIntExtra("tag", 0);		beans = new ArrayList<OrderBean>();	}	@Override	public void initViews() {		titleTextView = (TextView) findViewById(R.id.title_text);		if (tag == 0) {			titleTextView.setText("我的订单");		} else {			titleTextView.setText("我的兑换记录");		}		listView = (ListView) findViewById(R.id.my_order_list);		button = (Button) findViewById(R.id.title_bt_left);	}	public void back(View view) {		this.finish();	}	@Override	public void setListener() {		if (tag == 0) {			return;		}		listView.setOnItemClickListener(new OnItemClickListener() {			@Override			public void onItemClick(AdapterView<?> arg0, View arg1, final int arg2,					long arg3) {				PDialog.showDialog(MyOrderActivity.this, "正在删除", "请稍等");				params = null;				params = new RequestParams();				params.put("id", beans.get(arg2).getId() + "");				HttpUtil.getHttpUtil().get(HttpUrls.deleteOrderP, params,						new JsonHttpResponseHandler() {							@Override							public void onFailure(Throwable e,									JSONArray errorResponse) {								super.onFailure(e, errorResponse);							}							@Override							public void onFinish(String url) {								super.onFinish(url);								PDialog.hidenDialog();							}							@Override							public void onSuccess(int statusCode,									JSONObject response) {								super.onSuccess(statusCode, response);								try {									isOk=response.getBoolean("isok");								} catch (JSONException e) {									e.printStackTrace();								}								if (isOk) {									Toasts.toast(MyOrderActivity.this, "删除成功");									beans.remove(arg2);									adpter.notifyDataSetChanged();								}							}						});			}		});	}	@Override	public void getData() {		PDialog.showDialog(this, "正在加载数据", "请稍等");		params = new RequestParams();		params.put("id", Data.userBean.getId() + "");		Log.i("hck", "idid:" + Data.userBean.getId());		String httpUrl = null;		if (tag == 0) {			httpUrl = HttpUrls.getUserNoOrderP;		} else {			httpUrl = HttpUrls.getUserChuLiP;		}		HttpUtil.getHttpUtil().get(httpUrl, params,				new JsonHttpResponseHandler() {					@Override					public void onFailure(Throwable error, String content) {						super.onFailure(error, content);						Toasts.toast(MyOrderActivity.this, "获取数据失败");					}					@Override					public void onSuccess(int statusCode, JSONObject response) {						super.onSuccess(statusCode, response);						try {							isOk = response.getBoolean("isok");							if (isOk) {								JsonUtil.getJsonUtil().getNowOrders(response,										beans);								setDate();							} else {								Toasts.toast(MyOrderActivity.this, "没有获取到数据");							}						} catch (JSONException e) {							e.printStackTrace();						}					}					@Override					public void onFinish(String url) {						super.onFinish(url);						PDialog.hidenDialog();					}				});	}	@Override	public void setDate() {		adpter = new NoChuLiOrderAdpter(beans, this);		listView.setAdapter(adpter);	}}